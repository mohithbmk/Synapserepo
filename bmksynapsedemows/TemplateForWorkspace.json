{
	"$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
	"contentVersion": "1.0.0.0",
	"parameters": {
		"workspaceName": {
			"type": "string",
			"metadata": "Workspace name",
			"defaultValue": "bmksynapsedemows"
		},
		"bmksynapsedemows-WorkspaceDefaultSqlServer_connectionString": {
			"type": "secureString",
			"metadata": "Secure string for 'connectionString' of 'bmksynapsedemows-WorkspaceDefaultSqlServer'",
			"defaultValue": "Integrated Security=False;Encrypt=True;Connection Timeout=30;Data Source=tcp:bmksynapsedemows.sql.azuresynapse.net,1433;Initial Catalog=@{linkedService().DBName}"
		},
		"bmksynapsedemows-WorkspaceDefaultStorage_properties_typeProperties_url": {
			"type": "string",
			"defaultValue": "https://bmksynapsedemodl.dfs.core.windows.net"
		},
		"nyc_tlc_green_sasUri": {
			"type": "secureString",
			"metadata": "Secure string for 'sasUri' of 'nyc_tlc_green'"
		}
	},
	"variables": {
		"workspaceId": "[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"
	},
	"resources": [
		{
			"name": "[concat(parameters('workspaceName'), '/bmksynapsedemows-WorkspaceDefaultSqlServer')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"parameters": {
					"DBName": {
						"type": "String"
					}
				},
				"annotations": [],
				"type": "AzureSqlDW",
				"typeProperties": {
					"connectionString": "[parameters('bmksynapsedemows-WorkspaceDefaultSqlServer_connectionString')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/bmksynapsedemows-WorkspaceDefaultStorage')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobFS",
				"typeProperties": {
					"url": "[parameters('bmksynapsedemows-WorkspaceDefaultStorage_properties_typeProperties_url')]"
				},
				"connectVia": {
					"referenceName": "AutoResolveIntegrationRuntime",
					"type": "IntegrationRuntimeReference"
				}
			},
			"dependsOn": [
				"[concat(variables('workspaceId'), '/integrationRuntimes/AutoResolveIntegrationRuntime')]"
			]
		},
		{
			"name": "[concat(parameters('workspaceName'), '/nyc_tlc_green')]",
			"type": "Microsoft.Synapse/workspaces/linkedServices",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"annotations": [],
				"type": "AzureBlobStorage",
				"typeProperties": {
					"sasUri": "[parameters('nyc_tlc_green_sasUri')]"
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/AutoResolveIntegrationRuntime')]",
			"type": "Microsoft.Synapse/workspaces/integrationRuntimes",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "Managed",
				"typeProperties": {
					"computeProperties": {
						"location": "AutoResolve",
						"dataFlowProperties": {
							"computeType": "General",
							"coreCount": 8,
							"timeToLive": 0
						}
					}
				}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/WorkspaceSystemIdentity')]",
			"type": "Microsoft.Synapse/workspaces/credentials",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"type": "ManagedIdentity",
				"typeProperties": {}
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/1_exploreTaxixone')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "nyc_taxi/Discovery"
				},
				"content": {
					"query": "-- This is auto-generated code\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE,\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n    ) AS [result]\n\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'abfss://nyc-taxi-data@bmksynapsedemodl.dfs.core.windows.net/raw/taxi_zone.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n    ) AS [result]\n\n-------------------------------------------------------------------\n--Examine the Datatypes for the columns\n-- check current DB\n\nEXEC sp_describe_first_result_set N'SELECT\n     *\nFROM\n    OPENROWSET(\n        BULK ''https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone.csv'',\n        FORMAT = ''CSV'',\n        PARSER_VERSION = ''2.0'',\n        HEADER_ROW = TRUE\n      )AS [result]'\n\n------------------------------------------------\n\nSELECT\n    MAX(LEN(LocationID)) as Len_locationid,\n    MAX(Len(Borough)) as Len_Borough,\n    MAX(len(Zone)) as Zone,\n    MAX(len(service_zone)) as Len_service_zone\nFROM\n    OPENROWSET(\n        BULK 'abfss://nyc-taxi-data@bmksynapsedemodl.dfs.core.windows.net/raw/taxi_zone.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n    ) AS [result]\n\n--- use with clause to provide explict datatypes-----------\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE,\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n    ) \n    with (\n        LocationID SMALLINT,\n        Borough VARCHAR(15),\n        Zone VARCHAR(50),\n        service_zone VARCHAR(15)\n    )AS [result]\n\n---------------------------------------------------------------------------------\nEXEC sp_describe_first_result_set N'SELECT\n     *\nFROM\n    OPENROWSET(\n        BULK ''https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone.csv'',\n        FORMAT = ''CSV'',\n        PARSER_VERSION = ''2.0'',\n        HEADER_ROW = TRUE,\n        FIELDTERMINATOR = '','',\n        ROWTERMINATOR = ''\\n''\n    ) \n    with (\n        LocationID SMALLINT,\n        Borough VARCHAR(15),\n        Zone VARCHAR(50),\n        service_zone VARCHAR(15)\n    )AS [result]'\n\n------------------------------------------------------------------------------------------------------\nSELECT name, collation_name from sys.databases\n-------------------------------------------------------------------------------------------------------------\n--specify utf8 collation  \nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE,\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n    ) \n    with (\n        LocationID SMALLINT,\n        Borough VARCHAR(15) COLLATE Latin1_General_100_CI_AI_SC_UTF8,\n        Zone VARCHAR(50) COLLATE Latin1_General_100_CI_AI_SC_UTF8,\n        service_zone VARCHAR(15) COLLATE Latin1_General_100_CI_AI_SC_UTF8\n    )AS [result]\n------------------------------------------------------------------------\nCREATE DATABASE nyc_taxi_discovery\nCOLLATE Latin1_General_100_CI_AI_SC_UTF8;\n\nuse nyc_taxi_discovery\n\nSELECT name, collation_name from sys.databases\n\n-------------------------------------------------------------\n--select only subset of columns\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE,\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n    ) \n    with (\n        Borough VARCHAR(15),\n        Zone VARCHAR(50)\n       \n    )AS [result]\n\n---------------\n\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone_without_header.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n)\nWITH(\n    LocationID SMALLINT,\n        Borough VARCHAR(15),\n        Zone VARCHAR(50),\n        service_zone VARCHAR(15)\n    ) AS [result]\n-------------------------\n---if we define like this subset of columns it takes blindly from starting directly--------------------\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone_without_header.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n)\nWITH(\n        Borough VARCHAR(15),\n        Zone VARCHAR(50)       \n    ) AS [result]\n--correct way of defining subset of column \nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone_without_header.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n)\nWITH(\n        Borough VARCHAR(15) 2,\n        Zone VARCHAR(50) 3\n) AS [result]\n---- we can get any columnal order by puting it in the with statement like zone first and borough second and \n--even change the name of the columns like from line 206 ---\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone_without_header.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n)\nWITH(\n        Zone VARCHAR(50) 3,\n        Borough VARCHAR(15) 2\n) AS [result]\n------+ i took the previous file here which have header using firstrow keyword without specifing header as true ------\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://bmksynapsedemodl.dfs.core.windows.net/nyc-taxi-data/raw/taxi_zone.csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        FIRSTROW = 2,\n        FIELDTERMINATOR = ',',\n        ROWTERMINATOR = '\\n'\n)\nWITH(\n        location_id SMALLINT,\n        borough VARCHAR(15),\n        zone VARCHAR(50),\n        service_zone VARCHAR(15)\n    ) AS [result]\n\n-------------------------------\n--create external datasource\n\nCREATE EXTERNAL DATA SOURCE nyc_taxi_data\nWITH\n(\nlocation = 'abfss://nyc-taxi-data@bmksynapsedemodl.dfs.core.windows.net'\n)\n---------------------------------------------------------------\nCREATE EXTERNAL DATA SOURCE nyc_taxi_data_raw\nWITH\n(\nlocation = 'abfss://nyc-taxi-data@bmksynapsedemodl.dfs.core.windows.net/raw'\n)\n-----------------------------------------------------------------\n--selecting data without using complete address in buk statement--- \nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'taxi_zone.csv',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n    ) \n     WITH\n    (\n        location_id SMALLINT 1 ,\n        borough VARCHAR(15) 2,\n        zone VARCHAR(50) 3,\n        service_zone VARCHAR(15) 4\n    )\n    AS [result]\n----\nDROP EXTERNAL DATA SOURCE nyc_taxi_data;\n\nselect name, location from sys.external_data_sources;\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "nyc_taxi_discovery",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/2_exploring calander data')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "nyc_taxi/Discovery"
				},
				"content": {
					"query": "use  nyc_taxi_discovery;\n\nSELECT *\n    FROM OPENROWSET(\n        BULK 'calendar.csv',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n   \n    )\n    WITH(\n        date_key INT,\n        date    DATE,\n        year    SMALLINT,\n        month   TINYINT,\n        day     TINYINT,\n        day_name varchar(20),\n        day_of_year SMALLINT,\n        week_of_year TINYINT,\n        month_name VARCHAR(20),\n        year_month    INT,\n        year_week INT\n\n    )AS [result]\n\n---- to get detail datatypes\n\nEXEC sys.sp_describe_first_result_set N'\nSELECT *\n    FROM OPENROWSET(\n        BULK ''calendar.csv'',\n        DATA_SOURCE = ''nyc_taxi_data_raw'',\n        FORMAT =''CSV'',\n        PARSER_VERSION = ''2.0'',\n        HEADER_ROW = TRUE\n   \n    )\n    WITH(\n        date_key INT,\n        date    DATE,\n        year    SMALLINT,\n        month   TINYINT,\n        day     TINYINT,\n        day_name varchar(20),\n        day_of_year SMALLINT,\n        week_of_year TINYINT,\n        month_name VARCHAR(20),\n        year_month    INT,\n        year_week INT\n\n    )AS [result]'\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "nyc_taxi_discovery",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/3_vendordiscoveryy')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "nyc_taxi/Discovery"
				},
				"content": {
					"query": "use nyc_taxi_discovery;\n\nSELECT *\n    FROM OPENROWSET(\n        BULK 'vendor_unquoted.csv',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE\n   \n    ) as vendor;\n\n--------------\nSELECT *\n    FROM OPENROWSET(\n        BULK 'vendor_escaped.csv',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE,\n        ESCAPECHAR = '\\\\'\n   \n    ) as vendor;\n\n--------------------\nSELECT *\n    FROM OPENROWSET(\n        BULK 'vendor.csv',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE,\n        FIELDQUOTE ='\"'\n   \n    ) as vendor;\n\n--or gives same result because it automatically predicts as per data\nSELECT *\n    FROM OPENROWSET(\n        BULK 'vendor.csv',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE \n    ) as vendor;\n\n\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "nyc_taxi_discovery",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/4_triptype')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "nyc_taxi/Discovery"
				},
				"content": {
					"query": "use nyc_taxi_discovery;\n\nSELECT *\n    FROM OPENROWSET(\n        BULK 'trip_type.tsv',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION = '2.0',\n        HEADER_ROW = TRUE,\n        FIELDTERMINATOR = '\\t'\n    ) as triptype;",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "nyc_taxi_discovery",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/5_payment_type')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "nyc_taxi/Discovery"
				},
				"content": {
					"query": "use nyc_taxi_discovery;\n--using csv parser to read json file and use jsonvalue keyword to get values into columns----\nSELECT CAST(JSON_VALUE(jsondoc,'$.payment_type') as smallint) payment_type,\n        CAST(JSON_VALUE(jsondoc,'$.payment_type_desc') as VARCHAR(15)) payment_type_desc\n    FROM OPENROWSET(\n        BULK 'payment_type.json',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION ='1.0',\n        FIELDTERMINATOR = '0x0b',\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0a'\n    )\n    with(\n        jsondoc NVARCHAR(MAX)\n    ) \n    AS paymenttype;\n\nEXEC sp_describe_first_result_set N'SELECT CAST(JSON_VALUE(jsondoc,''$.payment_type'') as smallint) payment_type,\n        CAST(JSON_VALUE(jsondoc,''$.payment_type_desc'') as VARCHAR(15)) payment_type_desc\n    FROM OPENROWSET(\n        BULK ''payment_type.json'',\n        DATA_SOURCE = ''nyc_taxi_data_raw'',\n        FORMAT =''CSV'',\n        PARSER_VERSION =''1.0'',\n        FIELDTERMINATOR = ''0x0b'',\n        FIELDQUOTE = ''0x0b'',\n        ROWTERMINATOR = ''0x0a''\n    )\n    with(\n        jsondoc NVARCHAR(MAX)\n    ) \n    AS paymenttype;'\n\n-- reading data from jason with arrays---\n\nSELECT CAST(JSON_VALUE(jsondoc,'$.payment_type') as smallint) payment_type,\n        CAST(JSON_VALUE(jsondoc,'$.payment_type_desc[0].value') as VARCHAR(15)) payment_type_desc_0,\n        CAST(JSON_VALUE(jsondoc,'$.payment_type_desc[1].value') as VARCHAR(15)) payment_type_desc_01\n    FROM OPENROWSET(\n        BULK 'payment_type_array.json',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION ='1.0',\n        FIELDTERMINATOR = '0x0b',\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0a'\n    )\n    with(\n        jsondoc NVARCHAR(MAX)\n    ) \n    AS paymenttype;\n\n---use openjson to explode the array--\n\nSELECT payment_type, payment_type_desc_value\n    FROM OPENROWSET(\n        BULK 'payment_type_array.json',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION ='1.0',\n        FIELDTERMINATOR = '0x0b',\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0a'\n    )\n    with(\n        jsondoc NVARCHAR(MAX)\n    ) \n    AS payment_type\n    CROSS APPLY OPENJSON(jsondoc)\n    WITH(\n        payment_type SMALLINT,\n        payment_type_desc NVARCHAR(MAX) AS JSON\n\n    )\n    CROSS APPLY OPENJSON(payment_type_desc)\n    WITH(\n        sub_type SMALLINT,\n        payment_type_desc_value VARCHAR(20) '$.value'\n    );\n\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "nyc_taxi_discovery",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/6_explore_rate_code')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "nyc_taxi/Discovery"
				},
				"content": {
					"query": "USE nyc_taxi_discovery;\n\nSELECT rate_code_id, rate_code\n    FROM OPENROWSET(\n        BULK 'rate_code.json',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION ='1.0',\n        FIELDTERMINATOR = '0x0b',\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0b'\n    )\n    with(\n        jsondoc NVARCHAR(MAX)\n    ) \n    AS rate_code\n    CROSS APPLY OPENJSON(jsondoc)\n    WITH(\n        rate_code_id TINYINT,\n        rate_code VARCHAR(20) \n    );\n-------------quering multyline json---\n\n\nSELECT rate_code_id, rate_code\n    FROM OPENROWSET(\n        BULK 'rate_code_multi_line.json',\n        DATA_SOURCE = 'nyc_taxi_data_raw',\n        FORMAT ='CSV',\n        PARSER_VERSION ='1.0',\n        FIELDTERMINATOR = '0x0b',\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0b'\n    )\n    with(\n        jsondoc NVARCHAR(MAX)\n    ) \n    AS rate_code\n    CROSS APPLY OPENJSON(jsondoc)\n    WITH(\n        rate_code_id TINYINT,\n        rate_code VARCHAR(20) \n    );",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "nyc_taxi_discovery",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		},
		{
			"name": "[concat(parameters('workspaceName'), '/7_explore_trip_data_green')]",
			"type": "Microsoft.Synapse/workspaces/sqlscripts",
			"apiVersion": "2019-06-01-preview",
			"properties": {
				"folder": {
					"name": "nyc_taxi/Discovery"
				},
				"content": {
					"query": "use nyc_taxi_discovery\n\nSELECT TOP 100 *\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=2020/month=01/green_tripdata_2020-01.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n---------select data from a folder---\n\nSELECT TOP 100 *\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=2020/month=01',--here it is selecting all the files in 01 month \n    -- if we have multipe files it will open all of them at a time and (we do also have wildcard characters usage like for selecting all *,\n    -- for selecting all csv files in that folder we use *.csv after the month=01/*.csv like that) \n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n---------select data from a sub-folder---\nSELECT TOP 100 *\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=2020/**',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n------------select data from a particular  sub-folders---\n\nSELECT TOP 100*\nFROM openrowset(\n    bulk ('trip_data_green_csv/year=2020/month=01/*.csv',\n    'trip_data_green_csv/year=2020/month=03/*.csv'),\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n-------------- if we want to select all the years and all the months data using morethan 1 wildcard characters----\nSELECT TOP 100 *\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n-- using filemetadata function filename() to know the address of that record\n\nSELECT TOP 100 \n result.filename() as file_name,\n result.*\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n--counting no of records in each file--\n\nSELECT TOP 100 \n result.filename() as file_name,\n COUNT(1) as record_count\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n) as result\nGROUP BY result.filename()\norder by result.filename();\n\n--- need to count records in specific files if there are in multiple folders\n\nSELECT TOP 100 \n result.filename() as file_name,\n COUNT(1) as record_count\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n) as result\nWHERE result.filename() IN ('green_tripdata_2020-01.csv','green_tripdata_2020-10.csv','green_tripdata_2021-07.csv')\nGROUP BY result.filename()\norder by result.filename();\n\n---using filepath() function--\n\nSELECT TOP 100 \n result.filename() as file_name,\n COUNT(1) as record_count\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n) as result\nGROUP BY result.filename()\norder by result.filename();\n\n\n\n\n\n\n",
					"metadata": {
						"language": "sql"
					},
					"currentConnection": {
						"databaseName": "nyc_taxi_discovery",
						"poolName": "Built-in"
					},
					"resultLimit": 5000
				},
				"type": "SqlQuery"
			},
			"dependsOn": []
		}
	]
}