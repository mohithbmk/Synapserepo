{
	"name": "5_create_bronze_views",
	"properties": {
		"folder": {
			"name": "nyc_taxi/ldw(logical datawarehouse)"
		},
		"content": {
			"query": "use nyc_taxi_ldw\nGO\n-- creating view of rate_code--\nDROP VIEW IF EXISTS bronze.vw_rate_code\nGO\n\nCREATE VIEW bronze.vw_rate_code\nAS\nSELECT rate_code_id, rate_code\n    FROM OPENROWSET(\n        BULK 'raw/rate_code.json',\n        DATA_SOURCE = 'nyc_taxi_src',\n        FORMAT ='CSV',\n        PARSER_VERSION ='1.0',\n        FIELDTERMINATOR = '0x0b',\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0b'\n    )\n    with(\n        jsondoc NVARCHAR(MAX)\n    ) \n    AS rate_code\n    CROSS APPLY OPENJSON(jsondoc)\n    WITH\n    (\n        rate_code_id TINYINT,\n        rate_code VARCHAR(20) \n    )\nGO\n\nSELECT * FROM bronze.vw_rate_code\nGO\n\n--creating view of  payment_type--\nDROP VIEW IF EXISTS bronze.vw_payment_type\nGO\n\nCREATE VIEW bronze.vw_payment_type\nAS\nSELECT payment_type, payment_type_desc_value\n    FROM OPENROWSET(\n        BULK 'raw/payment_type_array.json',\n        DATA_SOURCE = 'nyc_taxi_src',\n        FORMAT ='CSV',\n        PARSER_VERSION ='1.0',\n        FIELDTERMINATOR = '0x0b',\n        FIELDQUOTE = '0x0b',\n        ROWTERMINATOR = '0x0a'\n    )\n    with(\n        jsondoc NVARCHAR(MAX)\n    ) \n    AS payment_type\n    CROSS APPLY OPENJSON(jsondoc)\n    WITH(\n        payment_type SMALLINT,\n        payment_type_desc NVARCHAR(MAX) AS JSON\n\n    )\n    CROSS APPLY OPENJSON(payment_type_desc)\n    WITH(\n        sub_type SMALLINT,\n        payment_type_desc_value VARCHAR(20) '$.value'\n    )\nGO\n\nSELECT * FROM bronze.vw_payment_type\nGO\n\n\n----creating view on trip_data_green_csv---\n\nDROP VIEW IF EXISTS bronze.vw_trip_data_green_csv\nGO\n\nCREATE VIEW bronze.vw_trip_data_green_csv\nAS\nSELECT \n        result.filepath(1) as year,\n        result.filepath(2) as month,\n        result.*\n            FROM openrowset(\n                bulk 'raw/trip_data_green_csv/year=*/month=*/*.csv',\n                DATA_SOURCE='nyc_taxi_src',\n                format = 'CSV',\n                PARSER_VERSION = '2.0',\n                HEADER_ROW = TRUE\n                            )\n        WITH(\n                VendorID INT,\n                lpep_pickup_datetime datetime2(7),\n                lpep_dropoff_datetime datetime2(7),\n                store_and_fwd_flag char(1),\n                RatecodeID int,\n                PULocationID int,\n                DOLocationID int,\n                passenger_count int,\n                trip_distance float,\n                fare_amount float,\n                extra float,\n                mta_tax float,\n                tip_amount float,\n                tolls_amount float,\n                ehail_fee int,\n                improvement_surcharge float,\n                total_amount float,\n                payment_type int,\n                trip_type int,\n                congestion_surcharge float\n            ) AS [result]\nGO\n\nSELECT top (100) *\nFROM bronze.vw_trip_data_green_csv\nWHERE year = '2020' and month = '01'\nGO\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc_taxi_ldw",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}