{
	"name": "7_explore_trip_data_green",
	"properties": {
		"folder": {
			"name": "nyc_taxi/Discovery"
		},
		"content": {
			"query": "use nyc_taxi_discovery\n\nSELECT TOP 100 *\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=2020/month=01/green_tripdata_2020-01.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n---------select data from a folder---\n\nSELECT TOP 100 *\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=2020/month=01',--here it is selecting all the files in 01 month \n    -- if we have multipe files it will open all of them at a time and (we do also have wildcard characters usage like for selecting all *,\n    -- for selecting all csv files in that folder we use *.csv after the month=01/*.csv like that) \n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n---------select data from a sub-folder---\nSELECT TOP 100 *\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=2020/**',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n------------select data from a particular  sub-folders---\n\nSELECT TOP 100*\nFROM openrowset(\n    bulk ('trip_data_green_csv/year=2020/month=01/*.csv',\n    'trip_data_green_csv/year=2020/month=03/*.csv'),\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n-------------- if we want to select all the years and all the months data using morethan 1 wildcard characters----\nSELECT TOP 100 *\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n-- using filemetadata function filename() to know the address of that record\n\nSELECT TOP 100 \n result.filename() as file_name,\n result.*\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n    \n) as result\n\n--counting no of records in each file--\n\nSELECT TOP 100 \n result.filename() as file_name,\n COUNT(1) as record_count\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n) as result\nGROUP BY result.filename()\norder by result.filename();\n\n--- need to count records in specific files if there are in multiple folders\n\nSELECT TOP 100 \n result.filename() as file_name,\n COUNT(1) as record_count\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n) as result\nWHERE result.filename() IN ('green_tripdata_2020-01.csv','green_tripdata_2020-10.csv','green_tripdata_2021-07.csv')\nGROUP BY result.filename()\norder by result.filename();\n\n---using filepath() function--\n\nSELECT TOP 100 \n result.filename() as file_name,\n result.filepath() as file_path,\n COUNT(1) as record_count\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n) as result\nGROUP BY result.filename(), result.filepath()\norder by result.filename(), result.filepath();\n-----------------------------------------------------\nSELECT TOP 100 \n  result.filepath(1) as YEAR,\n result.filepath(2) as MONTH,\n COUNT(1) as record_count\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n) as result\nGROUP BY result.filename(), result.filepath(1),result.filepath(2)\norder by result.filename(), result.filepath(1),result.filepath(2);\n----selecting data from particular mnths-------------------------------------------------------------------------------\nSELECT TOP 100 \nresult.filepath(1) as YEAR,\n result.filepath(2) as MONTH,\n COUNT(1) as record_count\nFROM openrowset(\n    bulk 'trip_data_green_csv/year=*/month=*/*.csv',\n    DATA_SOURCE='nyc_taxi_data_raw',\n    format = 'CSV',\n    PARSER_VERSION = '2.0',\n    HEADER_ROW = TRUE\n) as result\nWHERE result.filepath(1) = '2020'\nAND result.filepath(2) IN ('02','05','09')\nGROUP BY result.filename(), result.filepath(1),result.filepath(2)\norder by result.filename(), result.filepath(1),result.filepath(2);\n\n\n\n\n\n",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "nyc_taxi_discovery",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}